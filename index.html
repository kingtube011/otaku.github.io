<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>オタク同時再生ツール</title>

  <!-- 🔸 AdSense -->
  <meta name="google-adsense-account" content="ca-pub-1233665276169336" />

  <style>
    body {
      background: #0f0f0f;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      font-size: 1.6rem;
      margin-top: 1rem;
      color: #ff66cc;
    }

    .description {
      color: #ccc;
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 0 10px;
    }

    .notice {
      font-size: 0.8rem;
      color: #ff8080;
      margin-top: 4px;
    }

    .top-buttons {
      margin-top: 10px;
    }

    .top-buttons a {
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      margin: 0 5px;
    }

    .youtube-btn { background-color: #ff0000; }
    .twitch-btn { background-color: #9146ff; }

    .input-container {
      margin: 20px auto;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    input {
      width: 300px;
      padding: 8px;
      border-radius: 6px;
      border: none;
      outline: none;
    }

    button {
      background: #ff4fa2;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover { opacity: 0.9; }

    .history {
      margin: 10px auto;
      padding: 10px;
      background: #181818;
      border-radius: 12px;
      max-width: 600px;
    }

    .history img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      margin: 4px;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .history img:hover {
      border-color: #ff4fa2;
    }

    .videos {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* 3プレイヤー */
      gap: 20px;
      margin: 20px auto;
      padding: 0 10px;
      max-width: 100%; /* 幅を100%にする */
      justify-content: center;
    }

    .player {
      background: #111;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s ease;
    }

    iframe {
      width: 100%;
      aspect-ratio: 16 / 9;
      border: none;
      border-radius: 8px;
    }

    .delete-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255, 79, 162, 0.9);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 18px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .player:hover .delete-btn {
      opacity: 1;
    }

    .controls {
      margin-top: 8px;
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .footer {
      color: #aaa;
      font-size: 0.8rem;
      margin: 30px 0;
      line-height: 1.8;
    }

    .sns-icons {
      margin-top: 8px;
    }

    .sns-icons a {
      display: inline-block;
      width: 28px;
      height: 28px;
      margin: 0 4px;
      opacity: 0.85;
      transition: opacity 0.2s;
    }

    .sns-icons a:hover {
      opacity: 1;
    }

    .sns-icons img {
      width: 100%;
      height: auto;
      border-radius: 6px;
    }

    @media (max-width: 600px) {
      input { width: 90%; }
      .videos { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>🎧 オタク同時再生ツール</h1>
  <p class="description">
    YouTube・Twitch（VOD/LIVE）を同時再生・一時停止・削除できる無料ツールです。<br>
    <span class="notice">※Twitchプレイヤーは公式制限により手動操作のみ対応しています。</span>
  </p>

  <div class="top-buttons">
    <a class="youtube-btn" href="https://www.youtube.com" target="_blank">YouTubeへ</a>
    <a class="twitch-btn" href="https://www.twitch.tv" target="_blank">Twitchへ</a>
  </div>

  <div class="input-container">
    <input id="urlInput" placeholder="動画や配信のURLを入力" />
    <button onclick="addVideo()">追加</button>
    <button onclick="playAll()">▶ 同時再生</button>
    <button onclick="pauseAll()">⏸ 一時停止</button>
    <button onclick="clearAll()">🗑 一括削除</button>
  </div>

  <div class="history" id="historyContainer">
    <strong>📜 過去に使ったチャンネル</strong><br>
    <div id="historyIcons"></div>
    <button onclick="clearHistory()">履歴を消去</button>
  </div>

  <div class="videos" id="videos"></div>

  <div class="footer">
    🎮 このサイトはYouTube・TwitchのAPIを利用した非公式ツールです。<br>
    💖 サイト運営支援 → 
    <a href="https://paypal.me/otakuplayer486" target="_blank" style="color:#ff4fa2;">PayPalで支援する</a>
    <div class="sns-icons">
      <a href="https://x.com/kingu_486" target="_blank" title="X(Twitter)">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/X_logo_2023_original.svg" alt="X">
      </a>
      <a href="https://www.youtube.com/@kingtube486" target="_blank" title="YouTube">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_2024.svg" alt="YouTube">
      </a>
    </div>
  </div>

  <script src="https://player.twitch.tv/js/embed/v1.js"></script>

  <script>
    const videos = [];
    const history = JSON.parse(localStorage.getItem("videoHistory") || "[]");
    const container = document.getElementById("videos");
    const historyContainer = document.getElementById("historyIcons");

    renderHistory();

    function addVideo() {
      const url = document.getElementById("urlInput").value.trim();
      if (!url) return alert("URLを入力してください！");

      let playerHTML = "";
      let platform = "";
      let id = "";

      if (url.includes("youtube")) {
        id = extractYouTubeID(url);
        if (!id) return alert("YouTubeのURLが無効です！");
        playerHTML = `<iframe src="https://www.youtube.com/embed/${id}?enablejsapi=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        platform = "YouTube";
      } else if (url.includes("twitch.tv")) {
        const channel = url.split("twitch.tv/")[1]?.split(/[/?]/)[0];
        if (!channel) return alert("TwitchのURLが無効です！");
        playerHTML = `<iframe src="https://player.twitch.tv/?channel=${channel}&parent=${location.hostname}&autoplay=false" allowfullscreen></iframe>`;
        platform = "Twitch";
      } else {
        return alert("対応していないURLです。");
      }

      const index = videos.length;
      const playerDiv = document.createElement("div");
      playerDiv.className = "player";
      playerDiv.innerHTML = `
        ${playerHTML}
        <button class="delete-btn" onclick="removeVideo(${index})">✕</button>
        <div class="controls">
          ${platform === "YouTube"
            ? `<input type="number" id="sec${index}" value="10" min="1" style="width:50px;">
               <button onclick="seekVideo(${index}, -1)">⏪ Rewind</button>
               <button onclick="seekVideo(${index}, 1)">⏩ Advance</button>`
            : ""}
        </div>
      `;
      container.appendChild(playerDiv);
      videos.push({ url, platform, id });

      addToHistory(url);
      document.getElementById("urlInput").value = "";
    }

    function extractYouTubeID(url) {
      try {
        if (url.includes("youtu.be/"))
          return url.split("youtu.be/")[1].split(/[?&]/)[0];
        if (url.includes("v="))
          return url.split("v=")[1].split(/[?&]/)[0];
        if (url.includes("youtube.com/live/"))
          return url.split("youtube.com/live/")[1].split(/[?&]/)[0];
        const match = url.match(/(?:embed|shorts)\/([a-zA-Z0-9_-]{6,})/);
        if (match) return match[1];
        return null;
      } catch {
        return null;
      }
    }

    async function addToHistory(url) {
      if (history.includes(url)) return;
      history.unshift(url);
      if (history.length > 6) history.pop();
      localStorage.setItem("videoHistory", JSON.stringify(history));
      await renderHistory();
    }

    async function renderHistory() {
      historyContainer.innerHTML = "";
      for (const url of history) {
        let iconUrl = "https://via.placeholder.com/48/333/fff?text=?";
        try {
          if (url.includes("youtube")) {
            const id = extractYouTubeID(url);
            if (id) {
              const res = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
              const data = await res.json();
              iconUrl = data.thumbnail_url || iconUrl;
            }
          } else if (url.includes("twitch.tv")) {
            iconUrl = "https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png";
          }
        } catch {}
        const img = document.createElement("img");
        img.src = iconUrl;
        img.title = url;
        img.onclick = () => { document.getElementById("urlInput").value = url; };
        historyContainer.appendChild(img);
      }
    }

    function clearHistory() {
      localStorage.removeItem("videoHistory");
      history.length = 0;
      renderHistory();
    }

    function playAll() {
      document.querySelectorAll("iframe[src*='youtube.com']").forEach(frame => {
        frame.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
      });
    }

    function pauseAll() {
      document.querySelectorAll("iframe[src*='youtube.com']").forEach(frame => {
        frame.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
      });
    }

    function seekVideo(index, direction) {
      const sec = parseInt(document.getElementById(`sec${index}`).value) || 10;
      const frame = container.children[index].querySelector("iframe");
      frame.contentWindow.postMessage(
        JSON.stringify({ event: "command", func: "seekTo", args: [direction > 0 ? sec : -sec, true] }),
        "*"
      );
    }

    function removeVideo(index) {
      container.children[index].remove();
      videos[index] = null;
    }

    function clearAll() {
      container.innerHTML = "";
      videos.length = 0;
    }
  </script>
</body>
</html>
